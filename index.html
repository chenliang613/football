<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>英超分析平台 | Premier League Analytics</title>
  <link rel="stylesheet" href="css/style.css" />
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
</head>
<body>

<!-- ============================================================
     TOP NAVIGATION
     ============================================================ -->
<nav class="navbar">
  <div class="navbar-inner">
    <a class="navbar-brand" href="#">
      <div class="brand-logo">⚽</div>
      <div class="brand-text">
        <span class="brand-title">英超分析平台</span>
        <span class="brand-sub">Premier League Analytics</span>
      </div>
    </a>

    <div class="navbar-tabs">
      <button class="tab-btn active" data-tab="standings">
        <span class="tab-icon">🏆</span> 积分榜
      </button>
      <button class="tab-btn" data-tab="matches">
        <span class="tab-icon">⚽</span> 比赛分析
      </button>
      <button class="tab-btn" data-tab="players">
        <span class="tab-icon">👟</span> 球员数据
      </button>
      <button class="tab-btn" data-tab="predictions">
        <span class="tab-icon">🔮</span> 预测分析
      </button>
      <button class="tab-btn" data-tab="injuries">
        <span class="tab-icon">🏥</span> 伤情状态
      </button>
    </div>

    <div class="navbar-season">2025/26 Season · GW27</div>

    <!-- 数据状态指示器 -->
    <div id="data-status" class="data-status status-offline">
      <span class="status-dot">●</span> 静态数据
    </div>
    <button id="refresh-btn" class="refresh-btn" title="手动刷新数据">⟳</button>
  </div>
</nav>

<!-- ============================================================
     MAIN CONTENT
     ============================================================ -->
<div class="main-content">

  <!-- ========================
       TAB 1: STANDINGS
       ======================== -->
  <div class="tab-panel active" id="tab-standings">

    <!-- KPI Row -->
    <div class="grid-4 mb-20" id="standings-kpi">
      <!-- Rendered by standings.js -->
    </div>

    <div class="grid-2 mb-20">
      <!-- Standings Table -->
      <div style="grid-column: 1 / -1;">
        <div class="section-header">
          <h2 class="section-title">英超积分榜</h2>
          <div class="flex gap-8">
            <span style="display:flex;align-items:center;gap:4px;font-size:11px;color:var(--pl-blue)">
              <span style="width:10px;height:10px;background:var(--pl-blue);border-radius:2px;display:inline-block"></span> 欧冠
            </span>
            <span style="display:flex;align-items:center;gap:4px;font-size:11px;color:orange">
              <span style="width:10px;height:10px;background:orange;border-radius:2px;display:inline-block"></span> 欧联
            </span>
            <span style="display:flex;align-items:center;gap:4px;font-size:11px;color:var(--red)">
              <span style="width:10px;height:10px;background:var(--red);border-radius:2px;display:inline-block"></span> 降级区
            </span>
          </div>
        </div>
        <div class="table-wrapper">
          <table id="standings-table">
            <thead>
              <tr>
                <th style="width:40px">#</th>
                <th>球队</th>
                <th class="center">场</th>
                <th class="center">胜</th>
                <th class="center">平</th>
                <th class="center">负</th>
                <th class="center">进球</th>
                <th class="center">失球</th>
                <th class="center">净胜</th>
                <th class="center">积分</th>
                <th>近5场</th>
              </tr>
            </thead>
            <tbody id="standings-tbody">
              <!-- Rendered by standings.js -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Trend Charts -->
    <div class="grid-2">
      <div class="card">
        <div class="card-title">📈 积分趋势（前6名，近6轮）</div>
        <div class="chart-container chart-md">
          <canvas id="chart-standings-trend"></canvas>
        </div>
      </div>
      <div class="card">
        <div class="card-title">🎯 进球/失球分布（前8名）</div>
        <div class="chart-container chart-md">
          <canvas id="chart-goals-dist"></canvas>
        </div>
      </div>
    </div>

  </div><!-- /tab-standings -->


  <!-- ========================
       TAB 2: MATCHES
       ======================== -->
  <div class="tab-panel" id="tab-matches">

    <div class="section-header">
      <h2 class="section-title">比赛数据分析</h2>
      <div class="filter-controls">
        <button class="filter-btn" data-filter="all">全部</button>
        <button class="filter-btn active" data-filter="completed">已完成</button>
      </div>
    </div>

    <!-- Match list -->
    <div class="matches-grid" id="matches-grid">
      <!-- Rendered by matches.js -->
    </div>

    <!-- Match Detail Panel — 深度分析 -->
    <div class="match-detail" id="match-detail">

      <!-- ① 标题行 -->
      <div class="match-detail-header">
        <div>
          <div class="section-title" id="detail-title">比赛详情</div>
          <div style="font-size:12px;color:var(--text-muted);margin-top:4px" id="detail-date"></div>
        </div>
        <button id="detail-close" style="background:none;border:none;color:var(--text-muted);font-size:20px;cursor:pointer">✕</button>
      </div>

      <!-- ② 赛后叙述 -->
      <div id="detail-narrative" class="detail-narrative"></div>

      <!-- ③ xG + 关键数据英雄栏 -->
      <div id="detail-hero" class="detail-hero"></div>

      <!-- ④ 主数据区：数据对比 | 比赛事件 | 雷达图 -->
      <div class="grid-3 gap-16 mb-16">
        <div>
          <div class="card-title">📊 数据对比</div>
          <div id="detail-stats-bars"></div>
        </div>
        <div>
          <div class="card-title">📋 比赛事件</div>
          <div id="detail-events" class="detail-events"></div>
        </div>
        <div>
          <div class="card-title">🕸 雷达图</div>
          <div class="chart-container chart-sm">
            <canvas id="chart-match-radar"></canvas>
          </div>
        </div>
      </div>

      <!-- ⑤ 图表区：控球率 | 进球分布 | 比赛走势 -->
      <div class="grid-3 gap-16 mb-16">
        <div>
          <div class="card-title">🔵 控球率</div>
          <div class="chart-container chart-sm">
            <canvas id="chart-possession"></canvas>
          </div>
        </div>
        <div>
          <div class="card-title">⚽ 进球时间分布</div>
          <div class="chart-container chart-sm">
            <canvas id="chart-goals-timeline"></canvas>
          </div>
        </div>
        <div>
          <div class="card-title">📈 比赛走势</div>
          <div class="chart-container chart-sm">
            <canvas id="chart-momentum"></canvas>
          </div>
        </div>
      </div>

      <!-- ⑥ 球员评分 -->
      <div>
        <div class="card-title">⭐ 球员评分</div>
        <div id="detail-ratings" class="ratings-grid"></div>
      </div>

    </div>

  </div><!-- /tab-matches -->


  <!-- ========================
       TAB 3: PLAYERS
       ======================== -->
  <div class="tab-panel" id="tab-players">

    <div class="section-header">
      <h2 class="section-title">球员数据统计</h2>
      <div class="filter-controls">
        <button class="filter-btn active" data-pos="all">全部</button>
        <button class="filter-btn" data-pos="ST">前锋</button>
        <button class="filter-btn" data-pos="AM">中场</button>
        <button class="filter-btn" data-pos="RW">边锋</button>
        <select class="filter-select" id="team-filter">
          <option value="all">所有球队</option>
        </select>
        <select class="filter-select" id="sort-filter">
          <option value="goals">按进球排序</option>
          <option value="assists">按助攻排序</option>
          <option value="rating">按评分排序</option>
          <option value="apps">按出场排序</option>
        </select>
      </div>
    </div>

    <!-- Top scorers table -->
    <div class="section-header mt-8">
      <h3 style="font-size:15px;font-weight:700;color:var(--text-secondary)">射手榜</h3>
    </div>
    <div class="table-wrapper mb-20">
      <table id="scorers-table">
        <thead>
          <tr>
            <th style="width:40px">#</th>
            <th>球员</th>
            <th>球队</th>
            <th class="center">场次</th>
            <th class="center">进球</th>
            <th class="center">助攻</th>
            <th class="center">射门</th>
            <th class="center">射正</th>
            <th class="center">每90分</th>
            <th class="center">评分</th>
          </tr>
        </thead>
        <tbody id="scorers-tbody">
          <!-- Rendered by players.js -->
        </tbody>
      </table>
    </div>

    <!-- Player Cards -->
    <div class="section-header">
      <h3 style="font-size:15px;font-weight:700;color:var(--text-secondary)">球员卡片（点击查看详情对比）</h3>
    </div>
    <div class="player-grid" id="player-cards">
      <!-- Rendered by players.js -->
    </div>

    <!-- Player Detail / Comparison -->
    <div id="player-detail-panel" style="display:none;margin-top:20px">
      <div class="grid-2 gap-16">
        <!-- Player stats radar -->
        <div class="card">
          <div class="card-title" id="player-detail-name">球员详情</div>
          <div class="chart-container chart-md">
            <canvas id="chart-player-radar"></canvas>
          </div>
        </div>

        <!-- Comparison -->
        <div class="card">
          <div class="card-title">⚔️ 数据对比</div>
          <div id="player-compare-bars">
            <!-- Rendered dynamically -->
          </div>
          <div class="chart-container chart-sm mt-16">
            <canvas id="chart-player-compare"></canvas>
          </div>
        </div>
      </div>
    </div>

  </div><!-- /tab-players -->


  <!-- ========================
       TAB 4: PREDICTIONS
       ======================== -->
  <div class="tab-panel" id="tab-predictions">

    <div class="section-header">
      <h2 class="section-title">预测与分析</h2>
      <div class="navbar-season" style="background:rgba(233,0,82,0.15);border-color:var(--accent);color:var(--accent)">
        第27轮 预测
      </div>
    </div>

    <!-- Match predictions -->
    <div class="grid-2 mb-4" id="predictions-grid">
      <!-- Rendered by predictions.js -->
    </div>

    <!-- ── 交互式深度分析面板（点击预测卡片展开）── -->
    <div id="prediction-detail" class="prediction-detail">

      <!-- 标题行 -->
      <div class="pred-header">
        <div>
          <div class="section-title" id="pred-detail-title"></div>
          <div id="pred-detail-meta" style="font-size:12px;color:var(--text-muted);margin-top:4px"></div>
        </div>
        <button id="pred-detail-close" class="pred-close-btn">✕</button>
      </div>

      <!-- ① 概率 + 比分分布 -->
      <div class="grid-2 gap-16 mb-16">
        <div>
          <div class="card-title">🎯 胜负概率</div>
          <div id="pred-prob-display"></div>
          <!-- 交互式预测参数 -->
          <div id="pred-sliders" style="margin-top:16px"></div>
        </div>
        <div>
          <div class="card-title">⚽ 最可能比分（泊松分布）</div>
          <div id="pred-score-probs"></div>
        </div>
      </div>

      <!-- ② 赛前新闻动态 -->
      <div class="news-section mb-16">
        <div class="card-title">📰 赛前新闻动态</div>
        <div id="pred-news"></div>
      </div>

      <!-- ③ 球队对比 + 雷达 + 近期状态 -->
      <div class="grid-3 gap-16 mb-16">
        <div>
          <div class="card-title">📊 实力横向对比</div>
          <div id="pred-team-compare"></div>
        </div>
        <div>
          <div class="card-title">🕸 综合实力雷达</div>
          <div class="chart-container chart-sm">
            <canvas id="chart-pred-radar"></canvas>
          </div>
        </div>
        <div>
          <div class="card-title">🔥 近5场状态</div>
          <div id="pred-form-strips"></div>
        </div>
      </div>

      <!-- ③ H2H + 关键球员 + 伤情 -->
      <div class="grid-3 gap-16 mb-16">
        <div>
          <div class="card-title">⚔️ 历史交锋</div>
          <div id="pred-h2h"></div>
        </div>
        <div>
          <div class="card-title">⭐ 关键球员</div>
          <div id="pred-key-players"></div>
        </div>
        <div>
          <div class="card-title">🏥 伤情影响</div>
          <div id="pred-injuries"></div>
        </div>
      </div>

      <!-- ⑤ AI 分析文字 -->
      <div>
        <div class="card-title">🧠 赛前深度分析</div>
        <div id="pred-analysis-text" class="pred-analysis-text"></div>
      </div>

    </div><!-- /prediction-detail -->

    <div class="grid-2 gap-16 mt-20">
      <!-- Championship Probability -->
      <div class="card">
        <div class="card-title">🏆 夺冠概率预测</div>
        <div class="champ-list" id="champ-list"></div>
        <div class="chart-container chart-md mt-16">
          <canvas id="chart-champ-prob"></canvas>
        </div>
      </div>

      <!-- Relegation Danger -->
      <div>
        <div class="card-title" style="margin-bottom:12px">🚨 降级危险指数</div>
        <div id="relegation-list" style="display:flex;flex-direction:column;gap:10px"></div>
      </div>
    </div>

  </div><!-- /tab-predictions -->


  <!-- ========================
       TAB 5: INJURIES
       ======================== -->
  <div class="tab-panel" id="tab-injuries">

    <div class="section-header">
      <h2 class="section-title">关键球员伤情与状态</h2>
    </div>

    <!-- KPI -->
    <div class="grid-4 mb-20" id="injury-kpi">
      <!-- Rendered by injuries.js -->
    </div>

    <!-- Injury Table -->
    <div class="section-header">
      <h3 style="font-size:15px;font-weight:700;color:var(--text-secondary)">伤情一览</h3>
    </div>
    <div class="table-wrapper mb-20">
      <table id="injuries-table">
        <thead>
          <tr>
            <th>球员</th>
            <th>球队</th>
            <th>位置</th>
            <th>伤势类型</th>
            <th class="center">严重程度</th>
            <th class="center">状态</th>
            <th>受伤日期</th>
            <th>预计复出</th>
            <th class="center">影响度</th>
          </tr>
        </thead>
        <tbody id="injuries-tbody">
          <!-- Rendered by injuries.js -->
        </tbody>
      </table>
    </div>

    <!-- Charts Row -->
    <div class="grid-2 gap-16 mb-20">
      <div class="card">
        <div class="card-title">🔥 球队近期状态评分（近5场）</div>
        <div class="chart-container chart-md">
          <canvas id="chart-team-form"></canvas>
        </div>
      </div>
      <div class="card">
        <div class="card-title">📊 伤病严重程度分布</div>
        <div class="chart-container chart-md">
          <canvas id="chart-injury-severity"></canvas>
        </div>
      </div>
    </div>

    <!-- Top teams form radar -->
    <div class="grid-2 gap-16">
      <div class="card">
        <div class="card-title">🕸 顶级球队状态雷达（近5场平均）</div>
        <div class="chart-container chart-lg">
          <canvas id="chart-form-radar"></canvas>
        </div>
      </div>
      <div class="card">
        <div class="card-title">💔 伤病影响球队战力分析</div>
        <div id="injury-impact-list" style="display:flex;flex-direction:column;gap:12px;margin-top:8px"></div>
      </div>
    </div>

  </div><!-- /tab-injuries -->

</div><!-- /main-content -->

<!-- ============================================================
     实时数据更新面板（右下角浮动）
     ============================================================ -->
<div id="live-panel" class="live-panel collapsed">

  <!-- 悬浮触发按钮 -->
  <button id="live-toggle-btn" class="live-toggle-btn" title="实时数据控制">
    <span class="live-toggle-icon">📡</span>
    <span id="live-toggle-dot" class="live-toggle-dot"></span>
  </button>

  <!-- 展开面板 -->
  <div class="live-panel-body">

    <div class="live-panel-head">
      <span class="live-panel-title">📡 实时数据</span>
      <button id="live-panel-close" class="live-panel-close" title="关闭">✕</button>
    </div>

    <!-- 当前状态 -->
    <div class="live-status-row">
      <span id="panel-status-dot" class="panel-dot offline">●</span>
      <span id="panel-status-text" class="panel-status-text">离线模式</span>
    </div>

    <!-- 上次更新时间 -->
    <div class="live-time-row">
      <span class="live-time-label">上次更新</span>
      <span id="panel-update-time" class="live-time-val">—</span>
    </div>

    <!-- 立即更新按钮 -->
    <button id="panel-refresh-btn" class="panel-refresh-btn">
      <span id="panel-refresh-icon" class="panel-refresh-icon">⟳</span>
      立即更新
    </button>

    <!-- API Key 提示（未配置时显示） -->
    <div id="panel-api-hint" class="panel-api-hint" style="display:none">
      ⚙️ 在 <code>js/config.js</code> 中填入<br>API Key 后可启用实时模式
    </div>

    <!-- 自动刷新开关 -->
    <div class="live-auto-row">
      <label class="live-auto-label">
        <input type="checkbox" id="panel-auto-toggle">
        <span class="live-auto-track"></span>
        <span class="live-auto-text">自动刷新</span>
      </label>
      <span id="panel-interval-text" class="live-interval-text">每5分钟</span>
    </div>

  </div>
</div>

<!-- ============================================================
     SCRIPTS (order matters: data first, then modules, then app)
     ============================================================ -->
<script src="js/config.js"></script>
<script src="js/data.js"></script>
<script src="js/analysis.js"></script>
<script src="js/api.js"></script>
<script src="js/dataService.js"></script>
<script src="js/standings.js"></script>
<script src="js/matches.js"></script>
<script src="js/players.js"></script>
<script src="js/predictions.js"></script>
<script src="js/injuries.js"></script>
<script src="js/app.js"></script>

</body>
</html>
